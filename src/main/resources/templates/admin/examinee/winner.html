<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:dr="http://www.minhw.com"
>

<head th:replace="/common/template :: header(~{::title},~{::link},~{::style})">
    <meta charset="UTF-8">
    <title>奖状上报 - [[${#params.value("website_title")}]]</title>
</head>
<body onload="countTime()">
<div id="wrapper">
    <!-- Navigation -->
    <div th:replace="/common/fragment :: frontendAdminHeadher"></div>
    <div id="page-wrapper">
        <div class="col-md-12 graphs">
            <div class="xs">
                <h3>获奖资料上报申请</h3>
                <div class="alert alert-info" id="show" role="alert">
                    <span id="showtime">
                        <span id="show_start">距离提交申请开始还有</span>
                        <span id="show_end">距离提交申请结束还有</span>
                        <span id="_d">00</span>
                        <span id="_h">00</span>
                        <span id="_m">00</span>
                        <span id="_s">00</span>
                    </span>
                </div>
                <div class="well1 white">
                    <form id="winner_form" class="form-floating ng-pristine ng-invalid"
                          novalidate="novalidate" method="post" ng-submit="submit()">
                        <div class="form-group">
                            <label class="control-label">姓名</label>
                            <input type="text" name="name" id="name"
                                   class="form-control1 ng-invalid ng-invalid-required ng-touched"
                                   ng-model="model.name" required="required">
                        </div>
                        <div class="form-group">
                            <label class="control-label">考生号</label>
                            <input type="text" name="ksh" id="ksh"
                                   class="form-control1  ng-invalid ng-valid-email ng-invalid-required ng-touched"
                                   ng-model="model.text" required="required">
                        </div>
                        <div class="form-group filled">
                            <label class="control-label">性别</label>
                            <!--                                <select class="form-control1 ng-invalid ng-invalid-required" ng-model="model.select"-->
                            <!--                                        required="">-->
                            <!--                                    <option value="0">男</option>-->
                            <!--                                    <option value="1">女</option>-->
                            <!--                                </select>-->
                            <div class="radios">
                                <label for="radio-01" class="label_radio">
                                    <input type="radio" name="sex" value="1" title="男" id="radio-01"> 男
                                </label>
                                <label for="radio-02" class="label_radio">
                                    <input type="radio" name="sex" value="2" title="女" id="radio-02"> 女
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="control-label">身份证号</label>
                            <input type="text" name="username" id="username"
                                   class="form-control1 ng-invalid ng-invalid-required ng-touched"
                                   value=""
                                   ng-model="model.text" required="required">
                        </div>
                        <div class="form-group">
                            <label class="control-label">联系电话</label>
                            <input type="text"
                                   class="form-control1 ng-invalid ng-valid-url ng-invalid-required ng-touched"
                                   ng-model="model.url" required="required">
                        </div>
                        <div class="form-group">
                            <label class="control-label">毕业学校</label>
                            <input type="text"
                                   class="form-control1 ng-invalid ng-valid-url ng-invalid-required ng-touched"
                                   ng-model="model.url" required="required">
                        </div>
                        <div class="form-group filled">
                            <label class="control-label">高考类别</label>
                            <select class="form-control1 ng-invalid ng-invalid-required" ng-model="model.select"
                                    dr:dict="CEEC"
                                    dr-selected="${param.status}"
                                    required="">
                            </select>
                        </div>
                        <div class="form-group">
                            <h4>我的奖项 &nbsp;<small>温馨提示：每次只能添加一个奖项，多个奖项请多次添加</small></h4>
                            <textarea style="height: 120px;" name="highestPrize" id="highestPrize"
                                      class="form-control1 ng-invalid ng-valid-url ng-invalid-required ng-touched"></textarea>
                        </div>
                        <div class="form-group">
                            <button type="button" class="btn btn-primary btn-lg" data-toggle="modal"
                                    data-target="#myModal">
                                添加最高奖项
                            </button>
                        </div>
                        <div class="form-group">
                            <label class="control-label">申请专业</label>
                            <input type="text"
                                   class="form-control1 ng-invalid ng-valid-url ng-invalid-required ng-touched"
                                   ng-model="model.url" required="required">
                        </div>

                        <!--                            <div class="form-group">-->
                        <!--                                <label class="control-label">Number</label>-->
                        <!--                                <input type="text"-->
                        <!--                                       class="form-control1 ng-invalid ng-invalid-required ng-valid-pattern ng-touched"-->
                        <!--                                       ng-model="model.number" ng-pattern="/[0-9]/" required="">-->
                        <!--                                <p class="help-block hint-block">Numeric values from 0-***</p>-->
                        <!--                            </div>-->

                        <!--                            <div class="form-group">-->
                        <!--                                <div class="checkbox1">-->
                        <!--                                    <label>-->
                        <!--                                        <input type="checkbox" ng-model="model.winner" required=""-->
                        <!--                                               class="ng-invalid ng-invalid-required">-->
                        <!--                                        我郑重的承诺我申请所用奖项符合学校要求，本人自愿承担不符合要求的后果-->
                        <!--                                    </label>-->
                        <!--                                </div>-->
                        <!--                            </div>-->
                        <div class="form-group filled">
                            <label class="control-label">申请类别</label>
                            <select class="form-control1 ng-invalid ng-invalid-required" ng-model="model.select"
                                    dr:dict="CEEC_TYPE"
                                    dr-selected="${param.status}"
                                    required="">
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="control-label">证明材料</label>
                            <input type="file" name="imags" id="imags" multiple="multiple" accept="image/png,image/jpeg"
                                   class="form-control1 ng-invalid ng-invalid-required ng-valid-pattern ng-touched"
                                   ng-model="model.file" required="required">
                            <p class="help-block hint-block">选择并上传通知文件中要求的全部材料</p>
                        </div>
                        <div class="form-group">
                            <button type="submit" id="submit" class="btn btn-primary">提交申请</button>
                            &nbsp;
                            <button type="reset" onclick="resetNum()" class="btn btn-default">重置表格</button>
                        </div>
                    </form>
                </div>
            </div>
            <div th:replace="/common/fragment :: frontendFooter"></div>
        </div>
    </div>
    <!-- /#page-wrapper -->
</div>
<!-- /#wrapper -->

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="gridSystemModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="gridSystemModalLabel">添加奖项</h4>
                <small>温馨提示：每次只能添加一个奖项，多个奖项请多次添加</small>
            </div>
            < class="modal-body">
            <form id="heightPrizeFrom">
                <div class="form-group">
                    <label class="control-label">获奖项目名称
                    </label>
                    <input class="form-control1 ng-invalid ng-valid-url ng-invalid-required ng-touched"
                           ng-model="model.url" name="HPname" id="HPname" required="required"/>
                </div>
                <div class="form-group">
                    <label class="control-label normal">获奖时间</label>
                    <input type="date" class="form-control1 ng-invalid ng-invalid-required"
                           ng-model="model.date" name="HPdata" id="HPdata" required=""/>
                </div>
                <div class="form-group">
                    <label class="control-label">获奖证书发证单位
                    </label>
                    <input class="form-control1 ng-invalid ng-valid-url ng-invalid-required ng-touched"
                           ng-model="model.url" name="HPDepartment" id="HPDepartment" required="required"/>
                </div>
                <div class="form-group">
                    <label class="control-label">获奖项目等级
                    </label>
                    <input class="form-control1 ng-invalid ng-valid-url ng-invalid-required ng-touched"
                           ng-model="model.url" name="HPgradeC" id="HPgradeC" required="required"/>

                </div>
            </form>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal"
                        onclick="smtHighestPrize()">添加
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script>
    let sumPrize = 0;
    const winner_start_time = new Date('[[${#params.value("winner_start")}]]').getTime();

    const winner_end = '[[${#params.value("winner_end")}]]';
    const winner_end_time = new Date(winner_end).getTime();

    smtHighestPrize = () => {
        messge("用户点击了添加奖项");
        sumPrize += 1;
        const heightPrizeFrom = $("#heightPrizeFrom").val();
        console.log(heightPrizeFrom)
        document.getElementById("highestPrize").append(
            "1-2021年四川省职业院校技能大赛零部件测绘与CAD成图赛项中获三等奖；" +
            "2-获乐山市职业学校技能大赛零部件测绘与CAD成图技术项目二等奖；" +
            "3-获乐山市青少年科技创新大赛优秀奖");
    }
    const resetNum = () => {
        sumPrize = 0;
    }

    const getText = (id) => {
        return document.getElementById(id).innerText.trim()
    }

    const resetFrom = () => {
        document.getElementById("winner_form").reset();
        document.getElementById("username").value = getText("shiro_username");
        document.getElementById("nickname").value = getText("shiro_nickname");
        document.getElementById("ksh").value = getText("shiro_ksh");
        resetFormValidation();
    }

    const countTime = () => {
        //获取当前时间
        const nowDate = new Date().getTime();
        const timeDifference = winner_start_time - nowDate;
        const endDate = timeDifference > 0 ? winner_start_time : winner_end_time;
        if (timeDifference > 0) {
            document.getElementById("show_end").style.display = 'none';
            document.getElementById("show_start").style.display = 'inline-block';
        } else {
            document.getElementById("show_start").style.display = 'none';
            document.getElementById("show_end").style.display = 'inline-block';
        }
        //时间差
        const leftTime = endDate - nowDate;
        //定义变量 d,h,m,s保存倒计时的时间
        let d, h, m, s;
        if (leftTime >= 0) {
            d = Math.floor(leftTime / 1000 / 60 / 60 / 24);
            h = Math.floor(leftTime / 1000 / 60 / 60 % 24);
            m = Math.floor(leftTime / 1000 / 60 % 60);
            s = Math.floor(leftTime / 1000 % 60);
            //将倒计时赋值到div中
            document.getElementById("_d").innerHTML = d + "天";
            document.getElementById("_h").innerHTML = h + "时";
            document.getElementById("_m").innerHTML = m + "分";
            document.getElementById("_s").innerHTML = s + "秒";
            //递归每秒调用countTime方法，显示动态时间效果
            setTimeout(countTime, 1000);
        } else {
            document.getElementById("showtime").style.display = 'none';
            document.getElementById("show").append("申请提交已截止，截止时间" + winner_end);
            $("#submit").attr("disabled", true);
        }
    }
    const validate_form = () => {
        $('#winner_form').formValidation({
            message: '不能为空',
            feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            fields: {
                nickname: {
                    message: '姓名无效',
                    validators: {
                        notEmpty: {
                            message: '姓名不能为空'
                        },
                    },
                },
                username: {
                    message: '身份证号码无效',
                    validators: {
                        notEmpty: {
                            message: '身份证号码不能为空'
                        },
                        stringLength: {
                            min: 15,
                            max: 18,
                            message: '身份证号码长度不足'
                        },
                        regexp: {
                            regexp: /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/,
                            // regexp: /(^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$)|(^[1-9]\d{5}\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{2}$)/,
                            message: '身份证号码格式错误'
                        }
                    }
                },
                ksh: {
                    message: '考生号无效',
                    validators: {
                        notEmpty: {
                            message: '考生号不能为空'
                        },
                        stringLength: {
                            min: 14,
                            max: 14,
                            message: '请输入14位考生号'
                        },
                        regexp: {
                            regexp: /(^\d{14}$)/,
                            message: '考生号格式错误'
                        }
                    }
                },
                imags: {
                    message: '文件无效',
                    validators: {
                        notEmpty: {
                            message: '证明材料不能为空'
                        },
                    }
                },
            }
        }).on('success.form.fv', function (e) {
            // Prevent form submission
            e.preventDefault();
            // Get the form instance
            const $form = $(e.target);
            // Get the FormValidation instance
            const validator = $form.data('formValidation');
            console.log(validator)
            submit()
        });
    }
    $(() => {
        resetFrom();
        countTime();
        validate_form();
    });
</script>
</body>
</html>